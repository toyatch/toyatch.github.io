---
layout: post
title:  "JUnit with Gradle"
date:   2022-07-03 22:35:00 +0900
tags: JUnit Gradle
---

## やりたいこと

JUnitをeclipseを使わず動かしたい(emacsだけで色々試したい)。
依存関係の解決等はGradleなるものを使うと便利らしいので、試してみる。

## Gradle

https://gradle.org/

## 準備

### Gradleのインストール

```
$ wget https://services.gradle.org/distributions/gradle-7.4.2-bin.zip
$ sudo mkdir /opt/gradle
$ sudo unzip -d /opt/gradle/ gradle-7.4.2-bin.zip
$ ls /opt/gradle/gradle-7.4.2/

$ echo 'export PATH="$PATH:/opt/gradle/gradle-7.4.2/bin"' >> ~/.bashrc
$ source ~/.bashrc

$ gradle -v
```

## 実装

### ファイル構成

```
$ tree .

.
|-- build.gradle
|-- settings.gradle
`-- src
    |-- main
    |   `-- java
    |       `-- hoge
    |           `-- Fuga.java
    `-- test
        `-- java
            `-- hoge
                `-- FugaTest.java

7 directories, 4 files
```

### Gradle設定ファイル

#### settings.gradle

```
rootProject.name = "hoge"
```

#### build.gradle

```
plugins {
  id "java"
}

repositories {
  mavenCentral()
}

test {
  useJUnitPlatform()
}

dependencies {
  testImplementation "org.junit.jupiter:junit-jupiter:5.8.2"
}
```

repositoriesが何かよくわかっていないのでひとまずおまじない。
これがないとビルドできず。

### テスト対象コード

#### Fuga.java

```
package hoge;

class Fuga {
	int value() {
		return 1;
	}
}

```

### テストコード

#### FugaTest.java

```
package hoge;

import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

public class FugaTest {
	@Test
	public void testValue() {
		Fuga fuga = new Fuga();
		assertEquals(1, fuga.value());
	}
}

```

## 実行

```
$ gradle test -i

...

BUILD SUCCESSFUL in 1s
3 actionable tasks: 2 executed, 1 up-to-date
```

何か動く
わざと失敗させると・・・↓

```
$ gradle test -i

...
FugaTest > testValue() FAILED
    org.opentest4j.AssertionFailedError: expected: <2> but was: <1>

...

BUILD FAILED in 1s
3 actionable tasks: 2 executed, 1 up-to-date
```
ちゃんと失敗する。テスト、動いている。

以上
